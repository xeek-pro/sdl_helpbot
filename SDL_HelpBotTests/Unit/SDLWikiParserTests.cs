using NUnit.Framework;
using SDL_HelpBotLibrary.Parsers;
using System;
using System.Collections.Generic;
using System.Linq;

namespace SDL_HelpBotTests.Unit
{
    [TestFixture]
    public class SDLWikiParserTests
    {
        readonly string rawDocumentSdlCreateWindow = "#pragma section-numbers off\r\n#pragma disable-camelcase\r\n\r\n= SDL_CreateWindow =\r\nUse this function to create a window with the specified position, dimensions, and flags.\r\n\r\n<<TableOfContents()>>\r\n\r\n== Syntax ==\r\n{{{#!highlight cpp\r\nSDL_Window* SDL_CreateWindow(const char* title,\r\n                             int         x,\r\n                             int         y,\r\n                             int         w,\r\n                             int         h,\r\n                             Uint32      flags)\r\n}}}\r\n\r\n== Function Parameters ==\r\n||'''title'''||the title of the window, in UTF-8 encoding||\r\n||'''x'''||the x position of the window, SDL_WINDOWPOS_CENTERED, or SDL_WINDOWPOS_UNDEFINED||\r\n||'''y'''||the y position of the window, SDL_WINDOWPOS_CENTERED, or SDL_WINDOWPOS_UNDEFINED||\r\n||'''w'''||the width of the window, in screen coordinates||\r\n||'''h'''||the height of the window, in screen coordinates||\r\n||'''flags'''||0, or one or more [[SDL_WindowFlags]] OR'd together; see [[#flags|Remarks]] for details||\r\n\r\n== Return Value ==\r\nReturns the window that was created or NULL on failure; call [[SDL_GetError]]() for more information.\r\n\r\n== Code Examples ==\r\n{{{#!highlight cpp\r\n// Example program:\r\n// Using SDL2 to create an application window\r\n\r\n#include \"SDL.h\"\r\n#include <stdio.h>\r\n\r\nint main(int argc, char* argv[]) {\r\n\r\n    SDL_Window *window;                    // Declare a pointer\r\n\r\n    SDL_Init(SDL_INIT_VIDEO);              // Initialize SDL2\r\n\r\n    // Create an application window with the following settings:\r\n    window = SDL_CreateWindow(\r\n        \"An SDL2 window\",                  // window title\r\n        SDL_WINDOWPOS_UNDEFINED,           // initial x position\r\n        SDL_WINDOWPOS_UNDEFINED,           // initial y position\r\n        640,                               // width, in pixels\r\n        480,                               // height, in pixels\r\n        SDL_WINDOW_OPENGL                  // flags - see below\r\n    );\r\n\r\n    // Check that the window was successfully created\r\n    if (window == NULL) {\r\n        // In the case that the window could not be made...\r\n        printf(\"Could not create window: %s\n\", SDL_GetError());\r\n        return 1;\r\n    }\r\n\r\n    // The window is open: could enter program loop here (see SDL_PollEvent())\r\n\r\n    SDL_Delay(3000);  // Pause execution for 3000 milliseconds, for example\r\n\r\n    // Close and destroy the window\r\n    SDL_DestroyWindow(window);\r\n\r\n    // Clean up\r\n    SDL_Quit();\r\n    return 0;\r\n}\r\n\r\n}}}\r\n\r\n== Remarks ==\r\n<<Anchor(flags)>> '''flags''' may be any of the following OR'd together:\r\n||SDL_WINDOW_FULLSCREEN||fullscreen window||\r\n||SDL_WINDOW_FULLSCREEN_DESKTOP||fullscreen window at the current desktop resolution||\r\n||SDL_WINDOW_OPENGL||window usable with OpenGL context||\r\n||SDL_WINDOW_VULKAN||window usable with a Vulkan instance||\r\n||SDL_WINDOW_HIDDEN||window is not visible||\r\n||SDL_WINDOW_BORDERLESS||no window decoration||\r\n||SDL_WINDOW_RESIZABLE||window can be resized||\r\n||SDL_WINDOW_MINIMIZED||window is minimized||\r\n||SDL_WINDOW_MAXIMIZED||window is maximized||\r\n||SDL_WINDOW_INPUT_GRABBED||window has grabbed input focus||\r\n||SDL_WINDOW_ALLOW_HIGHDPI||window should be created in high-DPI mode if supported (>= SDL 2.0.1)||\r\n\r\nSDL_WINDOW_SHOWN is ignored by SDL_!CreateWindow(). The SDL_Window is implicitly shown if SDL_WINDOW_HIDDEN is not set. SDL_WINDOW_SHOWN may be queried later using [[SDL_GetWindowFlags]]().\r\n\r\nOn Apple's OS X you '''must''' set the NSHighResolutionCapable Info.plist property to YES, otherwise you will not receive a High DPI OpenGL canvas.\r\n\r\nIf the window is created with the SDL_WINDOW_ALLOW_HIGHDPI flag, its size in pixels may differ from its size in screen coordinates on platforms with high-DPI support (e.g. iOS and Mac OS X). Use [[SDL_GetWindowSize]]() to query the client area's size in screen coordinates, and [[SDL_GL_GetDrawableSize]]() or [[SDL_GetRendererOutputSize]]() to query the drawable size in pixels.\r\n\r\nIf the window is set fullscreen, the width and height parameters '''w''' and '''h''' will not be used. However, invalid size parameters (e.g. too large) may still fail. Window size is actually limited to 16384 x 16384 for all platforms at window creation.\r\n\r\n== Version ==\r\nThis function is available since SDL 2.0.0.\r\n\r\n== Related Functions ==\r\n .[[SDL_CreateWindowFrom]]\r\n .[[SDL_DestroyWindow]]\r\n\r\n----\r\n[[CategoryAPI]], [[CategoryVideo]]\r\n";
        readonly Dictionary<string, string> expectedResultSdlCreateWindowAsMarkup = new Dictionary<string, string>()
        {
            { "SDL_CreateWindow", "Use this function to create a window with the specified position, dimensions, and flags." },
            { "Syntax", "```cpp\r\nSDL_Window* SDL_CreateWindow(const char* title,\r\n                             int         x,\r\n                             int         y,\r\n                             int         w,\r\n                             int         h,\r\n                             Uint32      flags)\r\n```" },
            { "Function Parameters", "**`title`** - the title of the window, in UTF-8 encoding\r\n**`x`** - the x position of the window, SDL_WINDOWPOS_CENTERED, or SDL_WINDOWPOS_UNDEFINED\r\n**`y`** - the y position of the window, SDL_WINDOWPOS_CENTERED, or SDL_WINDOWPOS_UNDEFINED\r\n**`w`** - the width of the window, in screen coordinates\r\n**`h`** - the height of the window, in screen coordinates\r\n**`flags`** - 0, or one or more [SDL_WindowFlags](http://www.example.com/SDL_WindowFlags) OR'd together; see [Remarks](http://www.example.com/#flags) for details" },
            { "Return Value", "Returns the window that was created or NULL on failure; call [SDL_GetError](http://www.example.com/SDL_GetError)() for more information." },
            { "Code Examples", "```cpp\r\n// Example program:\r\n// Using SDL2 to create an application window\r\n\r\n\r\nint main(int argc, char* argv[]) {\r\n\r\n    SDL_Window *window;                    // Declare a pointer\r\n\r\n    SDL_Init(SDL_INIT_VIDEO);              // Initialize SDL2\r\n\r\n    // Create an application window with the following settings:\r\n    window = SDL_CreateWindow(\r\n        \"An SDL2 window\",                  // window title\r\n        SDL_WINDOWPOS_UNDEFINED,           // initial x position\r\n        SDL_WINDOWPOS_UNDEFINED,           // initial y position\r\n        640,                               // width, in pixels\r\n        480,                               // height, in pixels\r\n        SDL_WINDOW_OPENGL                  // flags - see below\r\n    );\r\n\r\n    // Check that the window was successfully created\r\n    if (window == NULL) {\r\n        // In the case that the window could not be made...\r\n        printf(\"Could not create window: %s\r\n\", SDL_GetError());\r\n        return 1;\r\n    }\r\n\r\n    // The window is open: could enter program loop here (see SDL_PollEvent())\r\n\r\n    SDL_Delay(3000);  // Pause execution for 3000 milliseconds, for example\r\n\r\n    // Close and destroy the window\r\n    SDL_DestroyWindow(window);\r\n\r\n    // Clean up\r\n    SDL_Quit();\r\n    return 0;\r\n}\r\n```" },
            { "Remarks", "**flags** may be any of the following OR'd together:\r\n**`SDL_WINDOW_FULLSCREEN`** - fullscreen window\r\n**`SDL_WINDOW_FULLSCREEN_DESKTOP`** - fullscreen window at the current desktop resolution\r\n**`SDL_WINDOW_OPENGL`** - window usable with OpenGL context\r\n**`SDL_WINDOW_VULKAN`** - window usable with a Vulkan instance\r\n**`SDL_WINDOW_HIDDEN`** - window is not visible\r\n**`SDL_WINDOW_BORDERLESS`** - no window decoration\r\n**`SDL_WINDOW_RESIZABLE`** - window can be resized\r\n**`SDL_WINDOW_MINIMIZED`** - window is minimized\r\n**`SDL_WINDOW_MAXIMIZED`** - window is maximized\r\n**`SDL_WINDOW_INPUT_GRABBED`** - window has grabbed input focus\r\n**`SDL_WINDOW_ALLOW_HIGHDPI`** - window should be created in high-DPI mode if supported (>= SDL 2.0.1)\r\n\r\nSDL_WINDOW_SHOWN is ignored by SDL_CreateWindow(). The SDL_Window is implicitly shown if SDL_WINDOW_HIDDEN is not set. SDL_WINDOW_SHOWN may be queried later using [SDL_GetWindowFlags](http://www.example.com/SDL_GetWindowFlags)().\r\n\r\nOn Apple's OS X you **must** set the NSHighResolutionCapable Info.plist property to YES, otherwise you will not receive a High DPI OpenGL canvas.\r\n\r\nIf the window is created with the SDL_WINDOW_ALLOW_HIGHDPI flag, its size in pixels may differ from its size in screen coordinates on platforms with high-DPI support (e.g. iOS and Mac OS X). Use [SDL_GetWindowSize](http://www.example.com/SDL_GetWindowSize)() to query the client area's size in screen coordinates, and [SDL_GL_GetDrawableSize](http://www.example.com/SDL_GL_GetDrawableSize)() or [SDL_GetRendererOutputSize](http://www.example.com/SDL_GetRendererOutputSize)() to query the drawable size in pixels.\r\n\r\nIf the window is set fullscreen, the width and height parameters **w** and **h** will not be used. However, invalid size parameters (e.g. too large) may still fail. Window size is actually limited to 16384 x 16384 for all platforms at window creation." },
            { "Version", "This function is available since SDL 2.0.0." },
            { "Related Functions", "[SDL_CreateWindowFrom](http://www.example.com/SDL_CreateWindowFrom)\r\n [SDL_DestroyWindow](http://www.example.com/SDL_DestroyWindow)" },
            { "Categories", "[CategoryAPI](http://www.example.com/CategoryAPI), [CategoryVideo](http://www.example.com/CategoryVideo)" }
        };

        readonly Dictionary<string, string> expectedResultSDlCreateWindowNonMarkup = new Dictionary<string, string>()
        {
            { "SDL_CreateWindow", "Use this function to create a window with the specified position, dimensions, and flags." },
            { "Syntax", "{{{#!highlight cpp\r\nSDL_Window* SDL_CreateWindow(const char* title,\r\n                             int         x,\r\n                             int         y,\r\n                             int         w,\r\n                             int         h,\r\n                             Uint32      flags)\r\n}}}" },
            { "Function Parameters", "||'''title'''||the title of the window, in UTF-8 encoding||\r\n||'''x'''||the x position of the window, SDL_WINDOWPOS_CENTERED, or SDL_WINDOWPOS_UNDEFINED||\r\n||'''y'''||the y position of the window, SDL_WINDOWPOS_CENTERED, or SDL_WINDOWPOS_UNDEFINED||\r\n||'''w'''||the width of the window, in screen coordinates||\r\n||'''h'''||the height of the window, in screen coordinates||\r\n||'''flags'''||0, or one or more [[SDL_WindowFlags]] OR'd together; see [[#flags|Remarks]] for details||" },
            { "Return Value", "Returns the window that was created or NULL on failure; call [[SDL_GetError]]() for more information." },
            { "Code Examples", "{{{#!highlight cpp\r\n// Example program:\r\n// Using SDL2 to create an application window\r\n\r\n\r\nint main(int argc, char* argv[]) {\r\n\r\n    SDL_Window *window;                    // Declare a pointer\r\n\r\n    SDL_Init(SDL_INIT_VIDEO);              // Initialize SDL2\r\n\r\n    // Create an application window with the following settings:\r\n    window = SDL_CreateWindow(\r\n        \"An SDL2 window\",                  // window title\r\n        SDL_WINDOWPOS_UNDEFINED,           // initial x position\r\n        SDL_WINDOWPOS_UNDEFINED,           // initial y position\r\n        640,                               // width, in pixels\r\n        480,                               // height, in pixels\r\n        SDL_WINDOW_OPENGL                  // flags - see below\r\n    );\r\n\r\n    // Check that the window was successfully created\r\n    if (window == NULL) {\r\n        // In the case that the window could not be made...\r\n        printf(\"Could not create window: %s\r\n\", SDL_GetError());\r\n        return 1;\r\n    }\r\n\r\n    // The window is open: could enter program loop here (see SDL_PollEvent())\r\n\r\n    SDL_Delay(3000);  // Pause execution for 3000 milliseconds, for example\r\n\r\n    // Close and destroy the window\r\n    SDL_DestroyWindow(window);\r\n\r\n    // Clean up\r\n    SDL_Quit();\r\n    return 0;\r\n}\r\n\r\n}}}" },
            { "Remarks", "'''flags''' may be any of the following OR'd together:\r\n||SDL_WINDOW_FULLSCREEN||fullscreen window||\r\n||SDL_WINDOW_FULLSCREEN_DESKTOP||fullscreen window at the current desktop resolution||\r\n||SDL_WINDOW_OPENGL||window usable with OpenGL context||\r\n||SDL_WINDOW_VULKAN||window usable with a Vulkan instance||\r\n||SDL_WINDOW_HIDDEN||window is not visible||\r\n||SDL_WINDOW_BORDERLESS||no window decoration||\r\n||SDL_WINDOW_RESIZABLE||window can be resized||\r\n||SDL_WINDOW_MINIMIZED||window is minimized||\r\n||SDL_WINDOW_MAXIMIZED||window is maximized||\r\n||SDL_WINDOW_INPUT_GRABBED||window has grabbed input focus||\r\n||SDL_WINDOW_ALLOW_HIGHDPI||window should be created in high-DPI mode if supported (>= SDL 2.0.1)||\r\n\r\nSDL_WINDOW_SHOWN is ignored by SDL_!CreateWindow(). The SDL_Window is implicitly shown if SDL_WINDOW_HIDDEN is not set. SDL_WINDOW_SHOWN may be queried later using [[SDL_GetWindowFlags]]().\r\n\r\nOn Apple's OS X you '''must''' set the NSHighResolutionCapable Info.plist property to YES, otherwise you will not receive a High DPI OpenGL canvas.\r\n\r\nIf the window is created with the SDL_WINDOW_ALLOW_HIGHDPI flag, its size in pixels may differ from its size in screen coordinates on platforms with high-DPI support (e.g. iOS and Mac OS X). Use [[SDL_GetWindowSize]]() to query the client area's size in screen coordinates, and [[SDL_GL_GetDrawableSize]]() or [[SDL_GetRendererOutputSize]]() to query the drawable size in pixels.\r\n\r\nIf the window is set fullscreen, the width and height parameters '''w''' and '''h''' will not be used. However, invalid size parameters (e.g. too large) may still fail. Window size is actually limited to 16384 x 16384 for all platforms at window creation." },
            { "Version", "This function is available since SDL 2.0.0." },
            { "Related Functions", ".[[SDL_CreateWindowFrom]]\r\n .[[SDL_DestroyWindow]]" },
            { "Categories", "[[CategoryAPI]], [[CategoryVideo]]" }
        };

        SDLWikiParser _parser;

        [OneTimeSetUp]
        public void SetUpFixture()
        {
            _parser = new SDLWikiParser(new Uri("http://www.example.com/"));
        }

        [Test]
        public void ParseDocumentAndConvertToMarkup()
        {
            var result = _parser.Parse(rawDocumentSdlCreateWindow, convertToMarkup: true);

            string resultConvertedToString = string.Join(",", result.OrderBy(kv => kv.Key));
            string expectedConvertedToString = string.Join(",", expectedResultSdlCreateWindowAsMarkup.OrderBy(kv => kv.Key));

            Assert.AreEqual(resultConvertedToString, expectedConvertedToString);
        }

        [Test]
        public void ParseDocumentWithoutMarkup()
        {
            var result = _parser.Parse(rawDocumentSdlCreateWindow, convertToMarkup: false);

            string resultConvertedToString = string.Join(",", result.OrderBy(kv => kv.Key));
            string expectedConvertedToString = string.Join(",", expectedResultSDlCreateWindowNonMarkup.OrderBy(kv => kv.Key));

            Assert.AreEqual(resultConvertedToString, expectedConvertedToString);
        }
    }
}
